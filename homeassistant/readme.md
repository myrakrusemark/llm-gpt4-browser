## Home Assistant PyScript and Flask Server Integration

This README provides detailed instructions on setting up a Home Assistant environment with PyScript for automation, integrating with a Flask server for web browsing tasks, and configuring the necessary components for a seamless operation. Follow these steps to configure your system.

### Requirements

- Home Assistant installation with administrative access.
- Flask installed on the host computer where the server will run.
- An OpenAI API key for using the Custom Search Engine (CSE).

### Step 1: Setting Up PyScript through the Home Assistant GUI

1. Navigate to **Settings** > **Add-ons, Backups & Supervisor** > **Add-on Store** in Home Assistant.
2. Find and install the **"Pyscript Python scripting"** add-on.
3. Once installed, ensure it is enabled and configured according to your needs.

### Step 2: Todo List Integration

1. In Home Assistant, go to **Configuration** > **Integrations**.
2. Click on **+ Add Integration** and search for "Todo List".
3. Install the integration and configure it as needed.
4. Create two todo lists named "Search Results" and "Browsing Results" for handling the output of your scripts.

### Step 3: Creating the "Search Query" Text Input Helper

1. Go to **Configuration** > **Helpers** in Home Assistant.
2. Click **+ Add Helper** and choose **Text**.
3. Name it "Search Query" and save.

### Step 5: Preparing Python Scripts

1. Ensure your `google-search.py` script has the correct CSE key and ID filled in.
2. In `browse-web.py`, update the `server` variable to point to your Flask server's address.
3. Place these, and `clear-todo-list.py`, to `<homeassistant_config>/pyscript/`.

### Step 6: Creating Automations in Home Assistant

1. For each automation YAML provided, create a new automation in Home Assistant:
   - Navigate to **Configuration** > **Automations & Scenes** > **Automations**.
   - Click **+ Add Automation**, then **Edit in YAML**.
   - Copy and paste the provided YAML content for each automation.
   - Save your changes.

### Step 7: Configuring Extended OpenAI Conversation Assistant

If you are using GPT through Extended OpenAI Conversation, you can trigger a browsing session from HA Assist.

1. Add the provided YAML configuration for the "read_browsing_results" function into your Extended OpenAI Conversation assistant configuration.

### Final Steps

After completing these steps, test your setup by entering a search query in the "Search Query" helper, or talking to your HA Assistant.

When the search query changes, it triggers the "Perform Google Search" automation which adds the response from your Google CSE into the "Search Results" todo list.

When the "Search Results" todo list updates, it triggers the "Analyze Web Pages" automation. The python file makes a request to your Flask server running server.py by sending the search results along with your search query in a POST request. BrowseWeb() does all the heavy lifting of using GPT4 to browse web pages.

Ensure the Flask server is running and accessible by Home Assistant for the web browsing tasks to function properly.

When the final output is generated by BrowseWeb() on your server, it will send the response back to your HA instance, completing the POST request. A todo item will be added to your Browser Results todo list with the response. A notification will be sent to indicate the process is complete.

You will also be able to use the `read_browser_results` function in Assist to read your results after they are done!